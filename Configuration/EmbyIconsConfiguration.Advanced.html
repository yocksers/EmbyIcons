<form class="embyIconsForm">
    <div class="flex align-items-center" style="margin: 2em 0 .5em;">
        <h2 style="margin: 0;">Advanced Settings</h2>
    </div>
    <p class="fieldDescription" style="margin-bottom: 1.5em;">
        <strong>Warning:</strong> These are advanced settings that affect performance and memory usage. Only modify these if you understand the implications. Default values are recommended for most users.
    </p>

    <div class="paper-card" style="padding: 1.5em;">
        <h3 style="margin-top: 0;">Cache Sizes</h3>
        <p class="fieldDescription">Larger caches use more memory but improve performance by reducing processing overhead.</p>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Max Episode Cache Size:" min="100" max="50000" data-config-key="MaxEpisodeCacheSize" />
            <div class="fieldDescription">Maximum number of episode icon data entries to cache. Default: 2000.</div>
        </div>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Max Series Cache Size:" min="50" max="10000" data-config-key="MaxSeriesCacheSize" />
            <div class="fieldDescription">Maximum number of series aggregation results to cache. Default: 500.</div>
        </div>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Max Item-to-Profile Cache Size:" min="1000" max="100000" data-config-key="MaxItemToProfileCacheSize" />
            <div class="fieldDescription">Maximum number of item-to-profile mappings to cache. Default: 20000.</div>
        </div>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Max Collection-to-Profile Cache Size:" min="100" max="50000" data-config-key="MaxCollectionToProfileCacheSize" />
            <div class="fieldDescription">Maximum number of collection-to-profile mappings to cache. Default: 5000.</div>
        </div>
    </div>

    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
        <h3 style="margin-top: 0;">Cache Timing</h3>
        <p class="fieldDescription">Adjust how long data stays cached and how often caches are cleaned up.</p>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Episode Cache Expiration (hours):" min="1" max="168" data-config-key="EpisodeCacheSlidingExpirationHours" />
            <div class="fieldDescription">How long to keep episode icon data cached before expiring. Default: 6 hours.</div>
        </div>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Cache Pruning Interval (hours):" min="1" max="168" data-config-key="CachePruningIntervalHours" />
            <div class="fieldDescription">How often to remove old series aggregation cache entries. Default: 6 hours.</div>
        </div>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Cache Maintenance Interval (hours):" min="0.5" max="24" step="0.5" data-config-key="CacheMaintenanceIntervalHours" />
            <div class="fieldDescription">How often to compact memory caches. Default: 1 hour.</div>
        </div>
    </div>

    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
        <h3 style="margin-top: 0;">Performance</h3>
        <p class="fieldDescription">Control how the plugin utilizes system resources during image processing.</p>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Global Concurrency Multiplier:" min="0.1" max="2.0" step="0.05" data-config-key="GlobalConcurrencyMultiplier" />
            <div class="fieldDescription">
                Multiplier for processor count to determine max concurrent operations. Default: 0.75.
            </div>
        </div>
    </div>

    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
        <h3 style="margin-top: 0;">Feature Toggles</h3>
        <p class="fieldDescription">Enable or disable performance-related features.</p>

        <div class="checkboxContainer" style="margin-top: 1.5em;">
            <label>
                <input is="emby-checkbox" type="checkbox" data-config-key="EnableLazyIconLoading" />
                <span>Enable lazy icon loading (on-demand generation)</span>
            </label>
            <div class="fieldDescription">Only generate overlays when posters are viewed, not for entire libraries at once. Reduces server load during library scans.</div>
        </div>
        <div class="checkboxContainer" style="margin-top: 1.5em;">
            <label>
                <input is="emby-checkbox" type="checkbox" data-config-key="EnableIconTemplateCaching" />
                <span>Enable icon template caching</span>
            </label>
            <div class="fieldDescription">Pre-render common icon combinations (e.g., "4K + DTS + HDR") to improve performance and reduce CPU usage.</div>
        </div>
    </div>

    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
        <h3 style="margin-top: 0;">Testing & Diagnostics</h3>
        <p class="fieldDescription">Options for testing and troubleshooting image processing.</p>

        <div class="checkboxContainer" style="margin-top: 1.5em;">
            <label>
                <input is="emby-checkbox" type="checkbox" id="chkEnableDebugLogging" data-config-key="EnableDebugLogging" />
                <span>Enable detailed debug logging</span>
            </label>
            <div class="fieldDescription">Logs additional information to the Emby server log (useful for troubleshooting).</div>
        </div>
        <div class="checkboxContainer" style="margin-top: 1.5em;">
            <label>
                <input is="emby-checkbox" type="checkbox" id="chkForceDisableSkiaSharp" data-config-key="ForceDisableSkiaSharp" />
                <span style="color: #ffc107;"><strong>Force Disable SkiaSharp</strong></span>
            </label>
            <div class="fieldDescription" style="color: #ffc107;">
                <strong>Testing Only:</strong> Disables SkiaSharp even if available, forcing the plugin to use the fallback processor.
            </div>
        </div>
    </div>

    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
        <h3 style="margin-top: 0;">External API Integration</h3>
        <p class="fieldDescription">Configure external services for enhanced rating information.</p>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="text" label="MDBList API Key:" data-config-key="MDBListApiKey" autocomplete="off" />
            <div class="fieldDescription">
                Required for Popcorn-O-Meter (Rotten Tomatoes Audience Score) ratings. Get your free API key from <a href="https://mdblist.com/api/" target="_blank" style="color: var(--theme-primary-color);">mdblist.com/api</a>
            </div>
        </div>
    </div>

    <div class="paper-card" style="padding: 1.5em; margin-top: 2em;">
        <h3 style="margin-top: 0;">Rating Display Customization</h3>
        <p class="fieldDescription">Customize how rating scores appear on your media posters.</p>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Rating Font Size Multiplier:" min="0.3" max="2.0" step="0.05" data-profile-key="RatingFontSizeMultiplier" />
            <div class="fieldDescription">Controls the size of rating text relative to icon size. Default: 0.75 (75% of icon height).</div>
        </div>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="text" label="Percentage Symbol:" data-profile-key="RatingPercentageSuffix" maxlength="5" />
            <div class="fieldDescription">Customize or remove the "%" symbol for percentage ratings. Leave blank to hide. Default: %</div>
        </div>

        <div class="inputContainer" style="margin-top: 1.5em;">
            <input is="emby-input" type="number" label="Rating Text Vertical Offset:" min="-10" max="10" step="0.5" data-profile-key="RatingTextVerticalOffset" />
            <div class="fieldDescription">Fine-tune the vertical alignment of rating text. Negative values move text up, positive values move it down. Default: 0</div>
        </div>
    </div>

    <div style="margin-top: 2em;">
        <button is="emby-button" type="submit" class="raised button-submit block">
            <span>Save</span>
        </button>
    </div>
</form>